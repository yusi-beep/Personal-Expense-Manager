{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">Summary</h3>
<p><b>Income: </b>{{ income }} BGN</p>
<p><b>Expense: </b>{{ expense }} BGN</p>
<p><b>Balance: </b>{{ balance }} BGN</p>

<!-- PERIOD NAV -->
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 my-3">
  <div class="btn-group" role="group" aria-label="Scope">
    <a class="btn btn-outline-primary {% if scope == 'day' %}active{% endif %}"
       href="{{ url_for('home.index', scope='day', date=base_date_str) }}">Day</a>
    <a class="btn btn-outline-primary {% if scope == 'week' %}active{% endif %}"
       href="{{ url_for('home.index', scope='week', date=base_date_str) }}">Week</a>
    <a class="btn btn-outline-primary {% if scope == 'month' %}active{% endif %}"
       href="{{ url_for('home.index', scope='month', date=base_date_str) }}">Month</a>
    <a class="btn btn-outline-primary {% if scope == 'year' %}active{% endif %}"
       href="{{ url_for('home.index', scope='year', date=base_date_str) }}">Year</a>
  </div>

  <div class="d-flex align-items-center gap-2">
    <a class="btn btn-outline-secondary"
       href="{{ url_for('home.index', scope=scope, date=prev_date_str) }}">←</a>
    <span class="fw-semibold">{{ period_title }}</span>
    <a class="btn btn-outline-secondary"
       href="{{ url_for('home.index', scope=scope, date=next_date_str) }}">→</a>
  </div>

  <form class="d-flex" method="get" action="{{ url_for('home.index') }}">
    <input type="hidden" name="scope" value="{{ scope }}">
    <input type="date" name="date" class="form-control form-control-sm" value="{{ base_date_str }}">
    <button class="btn btn-sm btn-primary ms-2">Apply</button>
  </form>
</div>

<hr>

<!-- Row 1: два pie charts -->
<div class="row g-4">
  <div class="col-12 col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header"><h5 class="mb-0">Expenses by Category</h5></div>
      <div class="card-body d-flex justify-content-center">
        {% if cat_labels|length > 0 %}
          <div class="chart-box"><canvas id="categoryChart"></canvas></div>
        {% else %}
          <p class="text-muted m-0">No expense data for this range.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header"><h5 class="mb-0">Income by Category</h5></div>
      <div class="card-body d-flex justify-content-center">
        {% if inc_labels|length > 0 %}
          <div class="chart-box"><canvas id="incomeChart"></canvas></div>
        {% else %}
          <p class="text-muted m-0">No income data for this range.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Row 2: bar chart -->
<div class="row g-4 mt-1">
  <div class="col-12">
    <div class="card shadow-sm h-100">
      <div class="card-header"><h5 class="mb-0">Monthly Income vs Expense</h5></div>
      <div class="card-body d-flex justify-content-center">
        {% if months|length > 0 %}
          <div class="chart-box"><canvas id="monthlyChart"></canvas></div>
        {% else %}
          <p class="text-muted m-0">No monthly data for this range.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
    console.log("cat_labels:", {{ cat_labels|tojson }});
    console.log("cat_values:", {{ cat_values|tojson }});
    console.log("months:", {{ months|tojson }});
    console.log("income_vals:", {{ income_vals|tojson }});
    console.log("expense_vals:", {{ expense_vals|tojson }});

    window.onload = function() {
    renderCategoryChart({{ cat_labels|tojson }}, {{ cat_values|tojson }});
    renderIncomeCategoryChart({{ inc_labels|tojson }}, {{ inc_values|tojson }});
    renderMonthlyChart({{ months|tojson }}, {{ income_vals|tojson }}, {{ expense_vals|tojson }});
    }
</script>
{% endblock %}	