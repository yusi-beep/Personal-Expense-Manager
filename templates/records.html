{% extends "base.html" %}
{% block content %}

<div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
 	<h3 class="mb-2 mb-md-0">All Records</h3>
 	<div class="d-flex gap-2">
 		<a href="{{ url_for('records.add_record') }}" class="btn btn-success">Add Record</a>
		<a href="{{ url_for('categories.add_category') }}" class="btn btn-warning">Add Category</a>
	</div>
</div>

<!-- Export / Import -->
<div class="card mb-3">
	<div class="card-body d-flex flex-wrap align-items-center gap-2">
		<a href="{{ url_for('records.export_csv') }}" class="btn btn-outline-primary btn-sm">Export CSV</a>
		<a href="{{ url_for('records.export_pdf') }}" class="btn btn-outline-secondary btn-sm">Export PDF</a>

		<form class="d-flex flex-wrap align-items-center gap-2 ms-auto"
			action="{{ url_for('records.import_csv') }}"
			method="POST" enctype="multipart/form-data">
			<input type="file" name="file" accept=".csv"
				class="form-control form-control-sm" required>
			<div class="form-check">
				<input class="form-check-input" type="checkbox" id="createCats" name="create_missing_categories" checked>
				<label class="form-check-label" for="createCats">Create missing categories</label>
			</div>
			<button class="btn btn-success btn-sm" type="submit">Import CSV</button>
		</form>
	</div>
</div>

{% if records|length == 0 %}
	<div class="alert alert-info">No records yet. Use <b>Add Record</b> to create your first entry.</div>
{% else %}
	<table class="table table-striped table-hover align-middle">
		<thead>
			<tr>
				<th style="min-width:140px">
					<a href="{{ url_for('records.list_records', sort='asc' if sort=='desc' else 'desc') }}"
						class="text-decoration-none">
			            Date
						{% if sort == 'asc' %}
							▲
						{% else %}
							▼
						{% endif %}
					</a>
				</th>
				<th>Type</th>
				<th>Category</th>
				<th class="text-end">Amount</th>
				<th>Description</th>
				<th class="text-end" style="min-width:140px">Actions</th>
			</tr>
		</thead>
	<tbody>
		{% for r in records %}
		<tr>
			<td>{{ r.date }}</td>
			<td>{{ r.type|title }}</td>
			<td>{{ r.category }}</td>
			<td class="text-end">{{ "%.2f"|format(r.amount) }}</td>
			<td>{{ r.description }}</td>
			<td class="text-end">
			<a href="{{ url_for('records.edit_record', id=r.id) }}" class="btn btn-warning btn-sm">Edit</a>

			<form action="{{ url_for('records.delete_record', id=r.id) }}"
				method="POST" style="display:inline;">
				<button type="submit" class="btn btn-danger btn-sm"
					onclick="return confirm('Delete this record?');">
					Delete
				</button>
			</form>
			</td>
		</tr>
		{% endfor %}
	</tbody>
	</table>
{% endif %}

{% endblock %}
